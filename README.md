# Ksim V2.1 --- 多資產交易回測系統 (Trading Simulator)

Ksim V2.1 是一套以 **Python + Streamlit**
打造的互動式金融回測系統。本專案不僅能進行多資產模擬交易，也是示範
**軟體架構重構 (Refactoring)** 與 **AI 輔助開發 (AI-Assisted
Development)** 的實戰案例（連README也是生成的）。

------------------------------------------------------------------------

## 🔗 線上體驗 & 聯絡方式

-   Demo：<https://ksimv2-1.streamlit.app>
-   Email：jeremy0110aaa@gmail.com

------------------------------------------------------------------------

## 🛠 開發理念：從 V2 到 V2.1 的演進

本專案採用「**人類設計邏輯、AI
協助實作**」的開發模式，並透過架構重構，將臃腫且耦合的系統優化為模組化架構。

### 1. Human--AI Collaboration 工作流程

1.  **Design（人工）**
    -   制定交易規則（如保證金、強制平倉邏輯）
    -   規劃介面需求
    -   設計觀測期與視野分離等系統變數
2.  **Implementation（AI）**
    -   Gemini 協助撰寫 Python 程式
    -   自動偵測邏輯漏洞
    -   提升效能並做模組化拆分

------------------------------------------------------------------------

## 🧩 架構重構：從 V2 到 V2.1

### **V2（Legacy）**

-   系統由 `app.py`（介面）與 `data_manager.py`（資料）組成
-   類 MVC 架構尚未形成
-   邏輯與 UI 耦合、難維護

### **V2.1（Current）**

-   重構為 **5 個獨立模組**
-   引入類 MVC 流程，使邏輯、資料與視覺化清晰分離
-   擴展性與維護性更佳

------------------------------------------------------------------------

## 📂 模組架構概覽

  --------------------------------------------------------------------------------------------------------
  檔案名稱               模組角色                             職責說明
  ---------------------- ------------------------------------ --------------------------------------------
  **app.py**             Frontend / Controller                主程式入口、UI rendering、使用者互動處理

  **logic.py**           Backend Logic                        資金、訂單撮合、保證金、強制平倉等核心邏輯

  **charts.py**          Visualization                        Plotly 圖表繪製（K 線、MA、指標、互動標籤）

  **data_manager.py**    Data / ETL                           Yahoo Finance 資料擷取、清洗、技術指標計算

  **config.py**          Configuration                        全域參數，集中管理手續費、槓桿、MA 週期等
  --------------------------------------------------------------------------------------------------------

------------------------------------------------------------------------

## ✨ 核心功能特色

### **1. 多資產支援（Multi-Asset）**

自動套用最小單位與代碼驗證規則，支援： - 📈 股票（TSLA、NVDA） - 💱
外匯（JPY=X、EURUSD=X） - ₿ 加密貨幣（BTC-USD、ETH-USD）

------------------------------------------------------------------------

### **2. 進階模擬機制（Advanced Simulation）**

#### 🔹 観測期 & 視野分離

-   開始交易前預跑 **250 天**
-   確保長週期 MA（如 MA120）計算準確
-   介面僅顯示最後 **100 天**（避免圖形壓縮）

#### 🔹 保證金交易（Margin Trading）

-   支援 **1x ～ 20x 槓桿**
-   內建 **做空機制**\
-   即時計算維持保證金，觸發條件自動執行 **強制平倉（Liquidation）**

------------------------------------------------------------------------

### **3. 專業視覺化圖表（Plotly）**

-   互動式 K 線、均線、即時標籤
-   顯示持倉成本線、SL/TP 線
-   客製化 hover label 與動態標注

------------------------------------------------------------------------

## 🛠 本地安裝與執行

### 1. 環境需求

-   **Python 3.10+**（建議 3.13）

### 2. 安裝套件

``` bash
pip install streamlit pandas numpy yfinance plotly
```

### 3. 執行程式

``` bash
streamlit run app.py
```

啟動後瀏覽器將自動打開：
`http://localhost:8501`

------------------------------------------------------------------------

## 📜 使用說明

本專案僅供教育與學術研究使用，不構成投資建議。
資料來源：Yahoo Finance（請遵守 API 使用規範）

------------------------------------------------------------------------

## ⚙ Powered by

-   **Python**
-   **Gemini AI**
